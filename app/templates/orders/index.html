{% extends "base.html" %}
{% block title %}Orders - Pizza Management System{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-shopping-cart me-2"></i>Orders</h1>
    <a href="{{ url_for('orders.new') }}" class="btn btn-primary"><i class="fas fa-plus me-2"></i>New Order</a>
</div>
<div class="card">
    <div class="card-body">
        <table class="table table-hover">
            <thead>
                <tr><th>Order #</th><th>Customer</th><th>Employee</th><th>Date</th><th>Total</th><th>Tax</th><th>Status</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr>
                    <td>#{{ order.order_id }}</td>
                    <td>{{ order.customer_name }}</td>
                    <td>{{ order.employee_name }}</td>
                    <td>{{ order.order_date.strftime('%Y-%m-%d %H:%M') if order.order_date else 'N/A' }}</td>
                    <td>${{ "%.2f"|format(order.total_amount) }}</td>
                    <td>${{ "%.2f"|format(order.tax_amount) }} ({{ "%.1f"|format(order.tax_rate * 100) }}%)</td>
                    <td><span class="badge bg-{% if order.status == 'Completed' %}success{% elif order.status == 'Pending' %}warning{% else %}info{% endif %}">{{ order.status }}</span></td>
                    <td>
                        <a href="{{ url_for('orders.view', order_id=order.order_id) }}" class="btn btn-sm btn-info"><i class="fas fa-eye"></i></a>
                        <button class="btn btn-sm btn-danger" onclick="confirmDeleteOrder({{ order.order_id }})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteOrderModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this order?</p>
                <p class="fw-bold">Order #<span id="deleteOrderNumber"></span></p>
                <p class="text-muted mb-0">This will also delete all associated order details. This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteOrderBtn">Delete Order</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
let deleteOrderId = null;

function confirmDeleteOrder(id) {
    deleteOrderId = id;
    $('#deleteOrderNumber').text(id);
    $('#deleteOrderModal').modal('show');
}

$('#confirmDeleteOrderBtn').on('click', function() {
    if (deleteOrderId) {
        $.post("{{ url_for('orders.delete', order_id=0) }}".replace('/0', '/' + deleteOrderId))
            .done(function(r) {
                $('#deleteOrderModal').modal('hide');
                alert(r.message);
                location.reload();
            });
    }
});
</script>
{% endblock %}
