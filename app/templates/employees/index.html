{% extends "base.html" %}
{% block title %}Employees - Pizza Management System{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-user-tie me-2"></i>Employees</h1>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal"><i class="fas fa-plus me-2"></i>Add Employee</button>
</div>
<div class="card">
    <div class="card-body">
        <table class="table table-hover">
            <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Phone</th><th>Role</th><th>Hire Date</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>
                {% for emp in employees %}
                <tr>
                    <td>{{ emp.employee_id }}</td>
                    <td>{{ emp.full_name }}</td>
                    <td>{{ emp.email }}</td>
                    <td>{{ emp.phone }}</td>
                    <td><span class="badge bg-primary">{{ emp.role }}</span></td>
                    <td>{{ emp.hire_date.strftime('%Y-%m-%d') if emp.hire_date else 'N/A' }}</td>
                    <td>{% if emp.active %}<span class="badge bg-success">Active</span>{% else %}<span class="badge bg-danger">Inactive</span>{% endif %}</td>
                    <td>
                        <button class="btn btn-sm btn-warning" onclick="editEmployee({{ emp.employee_id }})"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-sm btn-danger" onclick="confirmDeleteEmployee({{ emp.employee_id }}, '{{ emp.full_name }}')"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<!-- Add Employee Modal -->
<div class="modal fade" id="addEmployeeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Add New Employee</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form id="addEmployeeForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>First Name</label><input type="text" class="form-control" name="first_name" required></div>
                        <div class="col-md-6 mb-3"><label>Last Name</label><input type="text" class="form-control" name="last_name" required></div>
                    </div>
                    <div class="mb-3"><label>Email</label><input type="email" class="form-control" name="email" required></div>
                    <div class="mb-3"><label>Phone</label><input type="tel" class="form-control" name="phone" required></div>
                    <div class="mb-3"><label>Role</label><select class="form-control" name="role" required><option>Manager</option><option>Cashier</option><option>Chef</option><option>Delivery</option></select></div>
                    <div class="mb-3"><label>Hire Date</label><input type="date" class="form-control" name="hire_date" required></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-primary">Add Employee</button></div>
            </form>
        </div>
    </div>
</div>
<!-- Edit Employee Modal -->
<div class="modal fade" id="editEmployeeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Edit Employee</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <form id="editEmployeeForm">
                <input type="hidden" id="edit_employee_id">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3"><label>First Name</label><input type="text" class="form-control" id="edit_first_name" name="first_name" required></div>
                        <div class="col-md-6 mb-3"><label>Last Name</label><input type="text" class="form-control" id="edit_last_name" name="last_name" required></div>
                    </div>
                    <div class="mb-3"><label>Email</label><input type="email" class="form-control" id="edit_email" name="email" required></div>
                    <div class="mb-3"><label>Phone</label><input type="tel" class="form-control" id="edit_phone" name="phone" required></div>
                    <div class="mb-3"><label>Role</label><select class="form-control" id="edit_role" name="role" required><option>Manager</option><option>Cashier</option><option>Chef</option><option>Delivery</option></select></div>
                    <div class="mb-3"><input type="checkbox" id="edit_active" name="active" value="true"> <label>Active</label></div>
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button><button type="submit" class="btn btn-warning">Update Employee</button></div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteEmployeeModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Confirm Delete</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this employee?</p>
                <p class="fw-bold" id="deleteEmployeeName"></p>
                <p class="text-muted mb-0">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteEmployeeBtn">Delete Employee</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>
$('#addEmployeeForm').on('submit', function(e) {
    e.preventDefault();
    $.post("{{ url_for('employees.create') }}", $(this).serialize()).done(function(r) { alert(r.message); location.reload(); });
});
function editEmployee(id) {
    $.get("{{ url_for('employees.get', employee_id=0) }}".replace('/0', '/' + id)).done(function(r) {
        if (r.success) {
            $('#edit_employee_id').val(r.employee.employee_id);
            $('#edit_first_name').val(r.employee.first_name);
            $('#edit_last_name').val(r.employee.last_name);
            $('#edit_email').val(r.employee.email);
            $('#edit_phone').val(r.employee.phone);
            $('#edit_role').val(r.employee.role);
            $('#edit_active').prop('checked', r.employee.active);
            $('#editEmployeeModal').modal('show');
        }
    });
}
$('#editEmployeeForm').on('submit', function(e) {
    e.preventDefault();
    const id = $('#edit_employee_id').val();
    $.post("{{ url_for('employees.update', employee_id=0) }}".replace('/0', '/' + id), $(this).serialize()).done(function(r) { alert(r.message); location.reload(); });
});
let deleteEmployeeId = null;

function confirmDeleteEmployee(id, name) {
    deleteEmployeeId = id;
    $('#deleteEmployeeName').text(name);
    $('#deleteEmployeeModal').modal('show');
}

$('#confirmDeleteEmployeeBtn').on('click', function() {
    if (deleteEmployeeId) {
        $.post("{{ url_for('employees.delete', employee_id=0) }}".replace('/0', '/' + deleteEmployeeId))
            .done(function(r) {
                $('#deleteEmployeeModal').modal('hide');
                alert(r.message);
                location.reload();
            });
    }
});
</script>
{% endblock %}
